
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Michael&#39;s Development Story">
    <title>Tag: Data - Michael&#39;s Development Story</title>
    <meta name="author" content="Michael Hur">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Michael&#39;s Development Story">
<meta property="og:url" content="http://michaelhur.github.io/tags/Data/index.html">
<meta property="og:site_name" content="Michael&#39;s Development Story">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Michael Hur">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-tt5otrcfnyzi0refn9zrhtfrt4xlibymuuibvd4oaixntnzpzpm8wmtxdjom.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Michael&#39;s Development Story
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/michaelhur"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:jhhur716@gmail.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/09/2021-06-02-PyMLB/"
                            aria-label=": PyMLB: Exploring MLB Data using Python"
                        >
                            PyMLB: Exploring MLB Data using Python
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-09T23:35:04+09:00">
	
		    Apr 09, 2022
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="Sabermetrics-Analysis-of-Baseball"><a href="#Sabermetrics-Analysis-of-Baseball" class="headerlink" title="Sabermetrics: Analysis of Baseball"></a>Sabermetrics: Analysis of Baseball</h3><p>As Bill James said “sabermetrics is the search for objective knowledge about baseball.” Unlike the classical baseball statistics such as win or home run, it aims to derive statistic that can objectively quantify the players’ performance. For example, in 2018 New York Mets’ rookie pitcher Jacob deGrom has the record of 10 wins and 9 losses. Looking at win-loss ratio, it only implies that he is a mediocre pitcher, but he has received Cy Young Award (the Pitcher of the Year) and Rookie of the Year for his outstanding performance. <a target="_blank" rel="noopener" href="https://www.fangraphs.com/players/jacob-degrom/10954/stats?position=P">Over the span of four seasons, he has made 78 starts, in which he has only won 36 and lost 42.</a> During those 78 starts, <a target="_blank" rel="noopener" href="https://www.espn.com/mlb/story/_/id/31354867/new-york-mets-ace-jacob-degrom-lack-run-support-reaching-new-lows">deGrom only conceived one or less runs in 33 games; yet, he was not able to pick up a win.</a> As the example of Jacob deGrom shows, the classical statistic often fails to correctly reflect the player’s performance. As a result, Sabermetricians have derived statistics such as Wins Above Replacement (WAR), which measures a player’s value as to how many more wins the player contributes to the team in comparison with a replacement player in the same position. deGrom’s WAR was 9.0 in 2018, which in the transfer market translates to approximately $70 million making him one of the most expensive player in the league.</p>
<h3 id="Where-do-we-get-raw-data"><a href="#Where-do-we-get-raw-data" class="headerlink" title="Where do we get raw data?"></a>Where do we get raw data?</h3><p>Now that we know how important statistics is in baseball and want to be able to compute these more meaningful metrics, we first ened to figure out how to extract raw data. Fortunately, <a target="_blank" rel="noopener" href="https://statsapi.mlb.com/api/">Major League Baseball (MLB) has long made its data public</a> and this post will show you the guid on “how to extract data” from the MLB’s stats API, by extracting each batter’s at-bat outcome in the opening game of the 2021 season. </p>
<p><img src="https://michaelhur.github.io/images/20210602/screenshot1.png" alt="Excerpt from the MLB&#39;s Stats API"></p>
<h3 id="Understanding-the-API-Schema"><a href="#Understanding-the-API-Schema" class="headerlink" title="Understanding the API Schema"></a>Understanding the API Schema</h3><p>Although we can “brute-force” search every node in the tree until we obtain the desired fruit, the <a target="_blank" rel="noopener" href="https://beta-statsapi.mlb.com/docs/">API document</a> actually explains what the available keys are and what parameters the query takes at each level. Since we are interested in finding out the result of each “at-bat” in a specific game, we need to where these “play-by-play” data lies in. A thorough read tells us that such information is stroed under the “game” endpoints which stores all the data pertaining to the “game-level.”<br><img src="https://michaelhur.github.io/images/20210602/screenshot2.png" alt="The &quot;Game&quot; endpoints of the MLB&#39;s Stats API"></p>
<p>This <code>game</code> key requires a <code>game_pk</code> parameter. <code>game_pk</code> is a unique identifier assigned to each game. In order to obtain this <code>game_pk</code>, we will have to look into the <code>schedule</code> operation, which will return all the game on a given date. In short, in order to get the <code>play-by-play</code> data we will have to:</p>
<ol>
<li>From the <code>schedule</code> key, we extract the <code>game_pk</code> of the opening game of 2021 season.</li>
<li>Using this <code>game_pk</code>, we extract the <code>play-By-Play</code> data of the corresponding <code>game_pk.</code></li>
</ol>
<h3 id="Python-Approach"><a href="#Python-Approach" class="headerlink" title="Python Approach"></a>Python Approach</h3><p>We have three goals:</p>
<ol>
<li>From the <code>schedule</code> key, we extract the <code>game_pk</code> of the opening game of 2021 season.</li>
<li>Using this <code>game_pk</code>, we extract the <code>play-By-Play</code> data of the corresponding <code>game_pk.</code></li>
<li>Putting it all together so that we can extract other data with a simple change to the query.</li>
</ol>
<h2 id="Import-Libraries"><a href="#Import-Libraries" class="headerlink" title="Import Libraries"></a>Import Libraries</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br></pre></td></tr></table></figure>

<h3 id="1-Extract-game-pk-from-the-schedule-endpoints"><a href="#1-Extract-game-pk-from-the-schedule-endpoints" class="headerlink" title="1. Extract game_pk from the schedule endpoints"></a>1. Extract <code>game_pk</code> from the <code>schedule</code> endpoints</h3><p>A quick tip: </p>
<ul>
<li>The schedule endpoint requires either ‘sportId’ or ‘game_pk’.</li>
<li>Former will be used to obtain schedule on the given date(s).</li>
<li>Latter is used to obtain schedule given the unique game ID. Which seems like a backward operation, but think of the scenario where we want to figure out the detailed schedule such as date, venue or home&#x2F;away of the specific game.</li>
<li>Parameter ‘sportId’ should be 1</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Production version url</span></span><br><span class="line">schedule_url = <span class="string">&#x27;http://statsapi.mlb.com/api/v1/schedule?sportId=1&amp;date=04/01/2021&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schedule_response = requests.get(schedule_url)</span><br><span class="line">schedule_content = schedule_response.content</span><br><span class="line">schedule_json_content = json.loads(schedule_content)</span><br></pre></td></tr></table></figure>

<p>After a successful load of the content, we want to see what it looks like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schedule_json_content</span><br></pre></td></tr></table></figure>
<p>A quick skim of the content implies that the most of the contents are under the key “dates.” To check there are more endpoints of the schedule endpoints:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schedule_json_content.keys()</span><br></pre></td></tr></table></figure>
<p>Since there is no other keys in this json object, we will explore more of the “dates” key.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dates_content = schedule_json_content[<span class="string">&#x27;dates&#x27;</span>]</span><br><span class="line">dates_content</span><br></pre></td></tr></table></figure>
<p>The output object is a list of json object(s). Since we queried only on a single date, we will have one json object in the list. Each ‘date’ json object has multiple “games” tags. Each tag corresponds to a game played on the given date.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">games_content = dates_content[<span class="number">0</span>][<span class="string">&#x27;games&#x27;</span>]</span><br><span class="line">games_content</span><br></pre></td></tr></table></figure>
<p>Again, it returns a list of ‘game’ json object. Each ‘game’ object contains the information about each game played on the given date. These information include:</p>
<ul>
<li>gamePk: The unique ID assigned to each game</li>
<li>link: The API link to this game</li>
<li>gameType: ‘R’ if regular game, ‘P’ if post-season, ‘N’ if pre-season</li>
<li>gameDate, officialDate: self-explanatory</li>
<li>status: has children tags such as detailedState, which tells us if the game is finished, cancelled, delayed, etc</li>
<li>teams: teams played the game, their current standings, scores, home&#x2F;away status</li>
</ul>
<p>Since are interested in obtaining ‘gamePk’ of the opening game:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gamePk_opening = games_content[<span class="number">0</span>][<span class="string">&#x27;gamePk&#x27;</span>]</span><br><span class="line">gamePk_opening</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">634642</span></span><br></pre></td></tr></table></figure>

<p>To sum it up, we can find ‘gamePk’ parameter in the following order:</p>
<ul>
<li>schedule -&gt; dates -&gt; games -&gt; gamePk.</li>
</ul>
<p>Or (not so) Pythonically:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gamePk_opening_alt = schedule_json_content[<span class="string">&#x27;dates&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;games&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;gamePk&#x27;</span>]</span><br><span class="line">gamePk_opening_alt</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">634642</span></span><br></pre></td></tr></table></figure>


<h3 id="2-Using-gamePk-to-extract-at-bat-data"><a href="#2-Using-gamePk-to-extract-at-bat-data" class="headerlink" title="2. Using gamePk to extract at-bat data"></a>2. Using <code>gamePk</code> to extract <code>at-bat</code> data</h3><p><a target="_blank" rel="noopener" href="https://beta-statsapi.mlb.com/docs/#!/game/playByPlay">The API document</a> says that we need to input the following url:</p>
<p><code>http://statsapi.mlb.com/api/v1/game/&#123;game_pk&#125;/playByPlay</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">playbyplay_url = <span class="string">&quot;http://statsapi.mlb.com/api/v1/game/634642/playByPlay&quot;</span></span><br></pre></td></tr></table></figure>

<p>Following the same steps as we did with the schedule endpoints:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">playbyplay_response = requests.get(playbyplay_url)</span><br><span class="line">playbyplay_content = playbyplay_response.content</span><br><span class="line">playbyplay_json_content = json.loads(playbyplay_content)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">playbyplay_json_content</span><br></pre></td></tr></table></figure>

<p>A quick skim of the content implies that the most of the contents are under the key <code>allPlays</code>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">allPlays_content = playbyplay_json_content[<span class="string">&#x27;allPlays&#x27;</span>]</span><br><span class="line">allPlays_content</span><br></pre></td></tr></table></figure>

<p>Again, this <code>allPlays</code> object is a list of <code>plays</code>. So we only dig into one for the exploratory work.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Play1 = allPlays_content[<span class="number">0</span>]</span><br><span class="line">Play1</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Play1.keys()</span><br></pre></td></tr></table></figure>

<p>Looking at the available keys of this endpoint, <code>result</code> key obviously contains the information we want: the outcome of each at bat.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Play1[<span class="string">&#x27;result&#x27;</span>]</span><br></pre></td></tr></table></figure>

<pre><code>&#123;&#39;type&#39;: &#39;atBat&#39;,
 &#39;event&#39;: &#39;Groundout&#39;,
 &#39;eventType&#39;: &#39;field_out&#39;,
 &#39;description&#39;: &#39;Marcus Semien grounds out, shortstop Gleyber Torres to first baseman Jay Bruce.&#39;,
 &#39;rbi&#39;: 0,
 &#39;awayScore&#39;: 0,
 &#39;homeScore&#39;: 0&#125;
</code></pre>
<p>Here we are. We need to cautious here. <code>type</code> attributes implies that there could be play type that is not <code>atBat</code>.</p>
<p>So we loop through each play and filter out ones whose type is not <code>atBat</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">play_dict = &#123;&#125;</span><br><span class="line">play_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> play <span class="keyword">in</span> allPlays_content:</span><br><span class="line">    <span class="keyword">if</span> play[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] != <span class="string">&#x27;atBat&#x27;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    play_count += <span class="number">1</span></span><br><span class="line">    play_outcome = play[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;eventType&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    play_dict.update(&#123;play_count: play_outcome&#125;)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">play_dict</span><br></pre></td></tr></table></figure>

<pre><code>&#123;1: &#39;field_out&#39;,
 2: &#39;strikeout&#39;,
 3: &#39;field_out&#39;,
 4: &#39;field_out&#39;,
 5: &#39;strikeout&#39;,
 6: &#39;strikeout&#39;,
 7: &#39;single&#39;,
 8: &#39;single&#39;,
 9: &#39;single&#39;,
 10: &#39;field_out&#39;,
 11: &#39;strikeout&#39;,
 12: &#39;strikeout&#39;,
 13: &#39;field_out&#39;,
 14: &#39;single&#39;,
 15: &#39;strikeout&#39;,
 16: &#39;home_run&#39;,
 17: &#39;field_out&#39;,
 18: &#39;field_out&#39;,
 19: &#39;strikeout&#39;,
 20: &#39;strikeout&#39;,
 21: &#39;field_out&#39;,
 22: &#39;field_out&#39;,
 23: &#39;field_out&#39;,
 24: &#39;strikeout&#39;,
 25: &#39;walk&#39;,
 26: &#39;strikeout&#39;,
 27: &#39;field_out&#39;,
 28: &#39;strikeout&#39;,
 29: &#39;field_out&#39;,
 30: &#39;strikeout&#39;,
 31: &#39;field_out&#39;,
 32: &#39;single&#39;,
 33: &#39;field_out&#39;,
 34: &#39;field_out&#39;,
 35: &#39;field_out&#39;,
 36: &#39;field_out&#39;,
 37: &#39;walk&#39;,
 38: &#39;single&#39;,
 39: &#39;field_out&#39;,
 40: &#39;strikeout&#39;,
 41: &#39;home_run&#39;,
 42: &#39;walk&#39;,
 43: &#39;grounded_into_double_play&#39;,
 44: &#39;single&#39;,
 45: &#39;force_out&#39;,
 46: &#39;strikeout&#39;,
 47: &#39;walk&#39;,
 48: &#39;field_out&#39;,
 49: &#39;field_out&#39;,
 50: &#39;single&#39;,
 51: &#39;field_out&#39;,
 52: &#39;caught_stealing_2b&#39;,
 53: &#39;single&#39;,
 54: &#39;field_out&#39;,
 55: &#39;single&#39;,
 56: &#39;walk&#39;,
 57: &#39;grounded_into_double_play&#39;,
 58: &#39;strikeout&#39;,
 59: &#39;field_out&#39;,
 60: &#39;field_out&#39;,
 61: &#39;walk&#39;,
 62: &#39;strikeout&#39;,
 63: &#39;field_out&#39;,
 64: &#39;strikeout&#39;,
 65: &#39;single&#39;,
 66: &#39;field_out&#39;,
 67: &#39;strikeout&#39;,
 68: &#39;field_out&#39;,
 69: &#39;walk&#39;,
 70: &#39;strikeout&#39;,
 71: &#39;walk&#39;,
 72: &#39;fielders_choice_out&#39;,
 73: &#39;strikeout&#39;,
 74: &#39;double&#39;,
 75: &#39;strikeout&#39;,
 76: &#39;strikeout&#39;,
 77: &#39;strikeout&#39;,
 78: &#39;strikeout&#39;,
 79: &#39;strikeout&#39;,
 80: &#39;strikeout&#39;&#125;
</code></pre>
<p>Finally, we achieved what we wanted. The outcome of each at-bat.</p>
<h3 id="3-Putting-it-altogether"><a href="#3-Putting-it-altogether" class="headerlink" title="3. Putting it altogether"></a>3. Putting it altogether</h3><p>First we build a helper function that can be used generally.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_json</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="comment">## get_json: str -&gt; json</span></span><br><span class="line">    <span class="comment">## get_json() function takes &#x27;url&#x27; and returns the response in json format from the MLB Stats API.</span></span><br><span class="line">    </span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> (response.status_code != <span class="number">200</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;status code: %s&#x27;</span> % response.status_code)</span><br><span class="line">        time.sleep(<span class="number">1.0</span>)</span><br><span class="line">        get_json(url)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        content = response.content</span><br><span class="line">        json_content = json.loads(content)</span><br><span class="line">        <span class="keyword">return</span>(json_content)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">extract_game_id</span>(<span class="params">schedule_json</span>):</span><br><span class="line">    <span class="comment">## extract_game_id: json -&gt; listof int</span></span><br><span class="line">    <span class="comment">## extract_game_id() function takes a schedule response object and returns a list of game IDs.</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> schedule_json == &#123;&#125;:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    gameID_list = []</span><br><span class="line">    </span><br><span class="line">    dates = schedule_json[<span class="string">&#x27;dates&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> day <span class="keyword">in</span> dates:</span><br><span class="line">        games = day[<span class="string">&#x27;games&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> game <span class="keyword">in</span> games:</span><br><span class="line">            gameID = game[<span class="string">&#x27;gamePk&#x27;</span>]</span><br><span class="line">            gameID_list.append(gameID)</span><br><span class="line">   </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span>(gameID_list)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_game_ids</span>(<span class="params">date, endDate = <span class="literal">None</span>, teamId = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="comment">## get_game_ids: str int str str -&gt; listof int</span></span><br><span class="line">    <span class="comment">## get_game_ids() function returns the list of game IDs.</span></span><br><span class="line">    <span class="comment">## date must be of format &quot;YYYY-MM-DD&quot;. </span></span><br><span class="line">    <span class="comment">## If date is used without end_date, then it returns the list of game IDs on the input date.</span></span><br><span class="line">    <span class="comment">## If end_date is inputted, then it returns the list of game IDs in the period of date and end_date.</span></span><br><span class="line">    <span class="comment">## If teamID is inputted, then it will return game ID&#x27;s that the corresponding team played; otherwise, all.</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    base_schedule_url = <span class="string">&quot;http://statsapi.mlb.com/api/v1/schedule?sportId=1&quot;</span></span><br><span class="line">    alt_base_url = <span class="string">&quot;https://beta-statsapi.mlb.com:443/api/v1/schedule?sportId=1&quot;</span></span><br><span class="line">    suffix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> endDate <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        suffix = <span class="string">&quot;&amp;startDate=&quot;</span> + date + <span class="string">&quot;&amp;endDate=&quot;</span> + endDate</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        suffix = <span class="string">&quot;&amp;date=&quot;</span> + date</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> teamId <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        suffix = suffix + <span class="string">&quot;&amp;teamId=&quot;</span> + <span class="built_in">str</span>(teamId)</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = base_schedule_url + suffix</span><br><span class="line">        <span class="comment">#print(url)</span></span><br><span class="line">        schedule_content = get_json(url)</span><br><span class="line">        <span class="comment">#print(&#x27;status code: %s&#x27; % response.status_code)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment">#print(&#x27;Trying alternate route...&#x27;)</span></span><br><span class="line">        url = alt_base_url + suffix</span><br><span class="line">        <span class="comment">#print(url)</span></span><br><span class="line">        schedule_content = get_json(url)</span><br><span class="line">   </span><br><span class="line">    gameIDs = extract_game_id(schedule_content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(gameIDs)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_atbat_outcome</span>(<span class="params">listofgameIDs</span>):</span><br><span class="line">    </span><br><span class="line">    gameID_dict = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> gameID <span class="keyword">in</span> listofgameIDs:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            url =  <span class="string">&quot;http://statsapi.mlb.com/api/v1/game/&quot;</span> + <span class="built_in">str</span>(gameID) + <span class="string">&quot;/playByPlay&quot;</span></span><br><span class="line">            playbyplay_content = get_json(url)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="comment">#print(&#x27;Trying alternate route...&#x27;)</span></span><br><span class="line">            url = <span class="string">&quot;https://beta-statsapi.mlb.com:443/api/v1/game&quot;</span> + <span class="built_in">str</span>(gameID) + <span class="string">&quot;/playByPlay&quot;</span></span><br><span class="line">            playbyplay_content = get_json(url)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        allPlays_content = playbyplay_content[<span class="string">&#x27;allPlays&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">        play_dict = &#123;&#125;</span><br><span class="line">        play_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> play <span class="keyword">in</span> allPlays_content:</span><br><span class="line">            <span class="keyword">if</span> play[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] != <span class="string">&#x27;atBat&#x27;</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">            play_count += <span class="number">1</span></span><br><span class="line">            play_outcome = play[<span class="string">&#x27;result&#x27;</span>][<span class="string">&#x27;eventType&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            play_dict.update(&#123;play_count: play_outcome&#125;)</span><br><span class="line">            </span><br><span class="line">        gameID_dict.update(&#123;gameID:play_dict&#125;)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span>(gameID_dict)</span><br></pre></td></tr></table></figure>



                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/09/2021-06-02-PyMLB/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/09/2021-06-04-MongoDB/"
                            aria-label=": NoSQL and SQL - Part 1"
                        >
                            NoSQL and SQL - Part 1
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-09T23:35:04+09:00">
	
		    Apr 09, 2022
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>It is not always the case that perfectly cleaned and prepared data is available for data scientitsts to work with. In many times, data preprocessing is needed to feed the data into the later prcoesses such as analysis and visualization. This preprocessing step can be minimized, if not eliminated, at the data engineering step.</p>
<p>Whether it be a personal project, or team project at a start up or at a huge tech firm like FANG, at the earlier stage of the project one need to work out data schema. One of the dilemma I have faced when working out the data schema is what to include or not. Yes, it is one aspect that distinguishes a good data engineer from an average one. But it is not always perfectly clear whether we will be using certain parameter.</p>
<p>Include it? More feature means more overhead costs.</p>
<p>Exclude it? It is difficult and often impossible to add more features in the middle of the process.</p>
<p>This leads me to look into NoSQL.</p>
<h2 id="What-is-NoSQL-What’s-the-difference-between-SQL-and-NoSQL"><a href="#What-is-NoSQL-What’s-the-difference-between-SQL-and-NoSQL" class="headerlink" title="What is NoSQL? What’s the difference between SQL and NoSQL?"></a>What is NoSQL? What’s the difference between SQL and NoSQL?</h2><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>Structured Query Language. As its name suggest it is not entirely about the database itself; rather, it is a programming language used to interact with a certain type of database: relational database.</p>
<p>Relational database has two aspects.</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/09/2021-06-04-MongoDB/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/09/2021-06-11-Strike%20Zone/"
                            aria-label=": PyMLB to plot Pitch f/x data"
                        >
                            PyMLB to plot Pitch f/x data
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-09T23:35:04+09:00">
	
		    Apr 09, 2022
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>This time we will look at what the strike zone looks like for a Korean Pitcher “Ryu Hyun-Jin.” </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PyMLB <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>

<h4 id="1-Pull-schedule-data"><a href="#1-Pull-schedule-data" class="headerlink" title="1. Pull schedule data"></a>1. Pull schedule data</h4><p>First we need to pull all the game ID for this particular pitcher for this season. Using <a href="https://michaelhur.github.io/PyMLB/">get_schedule() function we coded last time</a>, we will extract schedule data. </p>
<p>Unfortunately, we can only pull the schedule data at the team level. So we will extract all the game his team “Toronto Blue Jays” has played this season, then filter the games he has played.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bluejays_schedule = get_schedule(teamId = <span class="number">141</span>, startDate = <span class="string">&quot;2021-04-01&quot;</span>, endDate = yesterday)</span><br></pre></td></tr></table></figure>

<p>The output looks like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(bluejays_schedule.values()))</span><br></pre></td></tr></table></figure>

<pre><code>[&#123;&#39;gamePk&#39;: 634642,
  &#39;home&#39;: &#123;&#39;ID&#39;: 147, &#39;name&#39;: &#39;New York Yankees&#39;&#125;,
  &#39;away&#39;: &#123;&#39;ID&#39;: 141, &#39;name&#39;: &#39;Toronto Blue Jays&#39;&#125;&#125;]
</code></pre>
<p>From this schedule dictionary, we will extract only the <code>gamePk</code> which will be used to pull pitch f&#x2F;x data for that particular game.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gamePks = [v[<span class="number">0</span>][<span class="string">&#x27;gamePk&#x27;</span>] <span class="keyword">for</span> k, v <span class="keyword">in</span> bluejays_schedule.items()]</span><br></pre></td></tr></table></figure>

<p>And the first 10 gamePk’s look like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gamePks[<span class="number">0</span>:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>

<pre><code>[634642,
 634644,
 634607,
 634612,
 634635,
 634583,
 634545,
 634512,
 632227,
 632208]
</code></pre>
<h4 id="2-Pitch-fx-data"><a href="#2-Pitch-fx-data" class="headerlink" title="2. Pitch fx data"></a>2. Pitch fx data</h4><p>Next step is to extract pitch fx data for each game. We will loop through each of gamePks we obtains above. Again, using get_pitchfx() function we coded last time:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pitchfx = get_pitchfx(<span class="number">634642</span>)</span><br></pre></td></tr></table></figure>

<p>As a reminder, get_pitchfx() returns pitch f&#x2F;x data as a dictionary object, where each key on the top level corresponds to each “at bat”. The second tier dictionary stores the pitch fx data we want, so we will extact them systematically.</p>
<p>In order to make analysis easier (or coding for the analysis easier), we will convert this dictionary object to a dataframe object. We remove the non-pitchfx data from the dictionary:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pitches = &#123;k:v <span class="keyword">for</span> k, v <span class="keyword">in</span> pitchfx.items() <span class="keyword">if</span> k != <span class="string">&quot;home_umpire&quot;</span>&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(pitches.values()))</span><br></pre></td></tr></table></figure>

<pre><code>&#123;&#39;inning&#39;: 1,
 &#39;home&#39;: &#39;home&#39;,
 &#39;pitcher&#39;: &#123;&#39;id&#39;: 543037,
  &#39;fullName&#39;: &#39;Gerrit Cole&#39;,
  &#39;link&#39;: &#39;/api/v1/people/543037&#39;&#125;,
 &#39;batter&#39;: &#123;&#39;id&#39;: 543760,
  &#39;fullName&#39;: &#39;Marcus Semien&#39;,
  &#39;link&#39;: &#39;/api/v1/people/543760&#39;&#125;,
 &#39;pitchHand&#39;: &#39;R&#39;,
 &#39;batSide&#39;: &#39;R&#39;,
 &#39;pitchData&#39;: [&#123;&#39;call&#39;: &#39;ball&#39;,
   &#39;sz_top&#39;: 3.25,
   &#39;sz_bottom&#39;: 1.53,
   &#39;x&#39;: -0.5,
   &#39;z&#39;: 3.54&#125;]&#125;
</code></pre>
<p>We will carry (almost) all the data in the dictionary into the dataframe object.</p>
<ol>
<li>Define an empty dataframe</li>
<li>Loop through each at bat</li>
<li>Loop through each pitch</li>
<li>Concatenate one row in each loop</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment">## Since we are carrying all the information to the dataframe object,</span></span><br><span class="line"><span class="comment">## we will label all the columns as is.</span></span><br><span class="line">pd_index = [<span class="string">&quot;atbat&quot;</span>, <span class="string">&quot;pitchCount&quot;</span>, <span class="string">&quot;inning&quot;</span>, <span class="string">&quot;home&quot;</span>, <span class="string">&quot;pitcher&quot;</span>, <span class="string">&quot;pitcherId&quot;</span>, <span class="string">&quot;pitchHand&quot;</span>,</span><br><span class="line">             <span class="string">&quot;batter&quot;</span>, <span class="string">&quot;batterId&quot;</span>, <span class="string">&quot;batSide&quot;</span>, <span class="string">&quot;sz_top&quot;</span>, <span class="string">&quot;sz_bottom&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;call&quot;</span>, <span class="string">&quot;actual&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">## Create an empty dataframe with only the column names defined.</span></span><br><span class="line">new_df = pd.DataFrame(index = pd_index).T</span><br><span class="line"></span><br><span class="line"><span class="comment">## For loop through each at bat</span></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> pitches.items():</span><br><span class="line">    atbat = k</span><br><span class="line">    inning = v[<span class="string">&#x27;inning&#x27;</span>]</span><br><span class="line">    home = v[<span class="string">&#x27;home&#x27;</span>]</span><br><span class="line">    pitcher = v[<span class="string">&#x27;pitcher&#x27;</span>][<span class="string">&#x27;fullName&#x27;</span>]</span><br><span class="line">    pitcherId = v[<span class="string">&#x27;pitcher&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">    pitchHand = v[<span class="string">&#x27;pitchHand&#x27;</span>]</span><br><span class="line">    batter = v[<span class="string">&#x27;batter&#x27;</span>][<span class="string">&#x27;fullName&#x27;</span>]</span><br><span class="line">    batterId = v[<span class="string">&#x27;batter&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">    batSide = v[<span class="string">&#x27;batSide&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    pitchCount = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">## For loop through each pitch</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> v[<span class="string">&#x27;pitchData&#x27;</span>]:</span><br><span class="line">        pitchCount += <span class="number">1</span></span><br><span class="line">        sz_top = p[<span class="string">&#x27;sz_top&#x27;</span>]</span><br><span class="line">        sz_bottom = p[<span class="string">&#x27;sz_bottom&#x27;</span>]</span><br><span class="line">        x = p[<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line">        z = p[<span class="string">&#x27;z&#x27;</span>]</span><br><span class="line">        call = p[<span class="string">&#x27;call&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment">## Given the actual strike zone, determine whether the call made was strike or not</span></span><br><span class="line">        actual = <span class="string">&quot;strike&quot;</span> <span class="keyword">if</span> (sz_bottom &lt;= z &lt;= sz_top) <span class="keyword">and</span> (-<span class="number">0.71</span> &lt; x &lt; <span class="number">0.71</span>) <span class="keyword">else</span> <span class="string">&quot;ball&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">## Each pitch will be turned into a single-row dataframe</span></span><br><span class="line">        new_row = [atbat, pitchCount, inning, home, pitcher, pitcherId, pitchHand,</span><br><span class="line">                   batter, batterId, batSide, sz_top, sz_bottom, x, z, call, actual]</span><br><span class="line"></span><br><span class="line">        new_df1 = pd.DataFrame(new_row, index = pd_index).T</span><br><span class="line">        </span><br><span class="line">        <span class="comment">## This newly defined data frame will be concatenated to the already existing dataframe.</span></span><br><span class="line">        new_df = pd.concat([new_df,new_df1])</span><br><span class="line"></span><br><span class="line"><span class="comment">## New column definitions:</span></span><br><span class="line"><span class="comment">## &#x27;calledRight&#x27;: Each entry is a boolean, whether the call made is correct or not</span></span><br><span class="line">new_df[<span class="string">&#x27;calledRight&#x27;</span>] = (new_df[<span class="string">&#x27;call&#x27;</span>] == new_df[<span class="string">&#x27;actual&#x27;</span>])</span><br><span class="line">new_df[<span class="string">&#x27;umpire&#x27;</span>] = pitchfx[<span class="string">&#x27;home_umpire&#x27;</span>]</span><br><span class="line">new_df.reset_index(drop = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>We will put this into the function so that we can apply it to any other pitch fx data.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">to_df</span>(<span class="params">pitchfx</span>):</span><br><span class="line">    </span><br><span class="line">    pitches = &#123;k:v <span class="keyword">for</span> k, v <span class="keyword">in</span> pitchfx.items() <span class="keyword">if</span> k != <span class="string">&quot;home_umpire&quot;</span>&#125;    </span><br><span class="line"></span><br><span class="line">    pd_index = [<span class="string">&quot;atbat&quot;</span>, <span class="string">&quot;pitchCount&quot;</span>, <span class="string">&quot;inning&quot;</span>, <span class="string">&quot;home&quot;</span>, <span class="string">&quot;pitcher&quot;</span>, <span class="string">&quot;pitcherId&quot;</span>, <span class="string">&quot;pitchHand&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;batter&quot;</span>, <span class="string">&quot;batterId&quot;</span>, <span class="string">&quot;batSide&quot;</span>, <span class="string">&quot;sz_top&quot;</span>, <span class="string">&quot;sz_bottom&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;call&quot;</span>, <span class="string">&quot;actual&quot;</span>]</span><br><span class="line"></span><br><span class="line">    new_df = pd.DataFrame(index = pd_index).T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> pitches.items():</span><br><span class="line">        atbat = k</span><br><span class="line">        inning = v[<span class="string">&#x27;inning&#x27;</span>]</span><br><span class="line">        home = v[<span class="string">&#x27;home&#x27;</span>]</span><br><span class="line">        pitcher = v[<span class="string">&#x27;pitcher&#x27;</span>][<span class="string">&#x27;fullName&#x27;</span>]</span><br><span class="line">        pitcherId = v[<span class="string">&#x27;pitcher&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        pitchHand = v[<span class="string">&#x27;pitchHand&#x27;</span>]</span><br><span class="line">        batter = v[<span class="string">&#x27;batter&#x27;</span>][<span class="string">&#x27;fullName&#x27;</span>]</span><br><span class="line">        batterId = v[<span class="string">&#x27;batter&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        batSide = v[<span class="string">&#x27;batSide&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pitchCount = <span class="number">0</span>   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> v[<span class="string">&#x27;pitchData&#x27;</span>]:</span><br><span class="line">            pitchCount += <span class="number">1</span></span><br><span class="line">            sz_top = p[<span class="string">&#x27;sz_top&#x27;</span>]</span><br><span class="line">            sz_bottom = p[<span class="string">&#x27;sz_bottom&#x27;</span>]</span><br><span class="line">            x = p[<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line">            z = p[<span class="string">&#x27;z&#x27;</span>]</span><br><span class="line">            call = p[<span class="string">&#x27;call&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            actual = <span class="string">&quot;strike&quot;</span> <span class="keyword">if</span> (sz_bottom &lt;= z &lt;= sz_top) <span class="keyword">and</span> (-<span class="number">0.71</span> &lt; x &lt; <span class="number">0.71</span>) <span class="keyword">else</span> <span class="string">&quot;ball&quot;</span></span><br><span class="line"></span><br><span class="line">            new_row = [atbat, pitchCount, inning, home, pitcher, pitcherId, pitchHand,</span><br><span class="line">                       batter, batterId, batSide, sz_top, sz_bottom, x, z, call, actual]</span><br><span class="line"></span><br><span class="line">            new_df1 = pd.DataFrame(new_row, index = pd_index).T</span><br><span class="line">            new_df = pd.concat([new_df,new_df1])</span><br><span class="line"></span><br><span class="line">    new_df[<span class="string">&#x27;calledRight&#x27;</span>] = (new_df[<span class="string">&#x27;call&#x27;</span>] == new_df[<span class="string">&#x27;actual&#x27;</span>])</span><br><span class="line">    new_df[<span class="string">&#x27;umpire&#x27;</span>] = pitchfx[<span class="string">&#x27;home_umpire&#x27;</span>]</span><br><span class="line">    new_df.reset_index(drop = <span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span>(new_df)</span><br></pre></td></tr></table></figure>

<p>Using one of the gamePk, we will try plot pitch fx data. Once succeed, we will apply to all gamePks.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df_634642 = to_df(pitchfx)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plotly.express <span class="keyword">as</span> px</span><br><span class="line"></span><br><span class="line"><span class="comment">## Plot scatter plot, grouped by strike and ball calls</span></span><br><span class="line">fig = px.scatter(df_634642, x=<span class="string">&quot;x&quot;</span>, y=<span class="string">&quot;z&quot;</span>, color=<span class="string">&quot;call&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Draw a rectangle that represents the strike zone</span></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">fig.update_traces(marker=<span class="built_in">dict</span>(size=<span class="number">12</span>,</span><br><span class="line">                              line=<span class="built_in">dict</span>(width=<span class="number">2</span>,</span><br><span class="line">                                        color=<span class="string">&#x27;DarkSlateGrey&#x27;</span>)),</span><br><span class="line">                  selector=<span class="built_in">dict</span>(mode=<span class="string">&#x27;markers&#x27;</span>))</span><br><span class="line"></span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://michaelhur.github.io/images/20210611/1.png"></p>
<p>In this game, we see quite a number of strikes that were placed well outside the strike zone. On the contrary, we see relatively fewer <code>ball</code> called even if it passed through the strike zone.</p>
<p>We want to see how they differ depending on home&#x2F;away.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fig = px.scatter(df_634642, x=<span class="string">&quot;x&quot;</span>, y=<span class="string">&quot;z&quot;</span>, color=<span class="string">&quot;call&quot;</span>, facet_col=<span class="string">&quot;home&quot;</span>,</span><br><span class="line">          labels=&#123;<span class="string">&quot;call&quot;</span>: <span class="string">&quot;Call&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x2&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fig.update_traces(marker=<span class="built_in">dict</span>(size=<span class="number">12</span>,</span><br><span class="line">                              line=<span class="built_in">dict</span>(width=<span class="number">2</span>,</span><br><span class="line">                                        color=<span class="string">&#x27;DarkSlateGrey&#x27;</span>)),</span><br><span class="line">                  selector=<span class="built_in">dict</span>(mode=<span class="string">&#x27;markers&#x27;</span>))</span><br><span class="line"></span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://michaelhur.github.io/images/20210611/2.png"></p>
<p>Interestingly, of all pitches placed in the lower right corner of the strike zone, there were more pitches called <code>ball</code> for the away team’s pitcher than the home team’s pitcher.</p>
<p>Now we look at all the strike calls and see where they landed at.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df_634642[df_634642.call == <span class="string">&quot;strike&quot;</span>][<span class="string">&#x27;calledRight&#x27;</span>].value_counts(normalize = <span class="literal">True</span>)*<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(df_634642[df_634642.call == <span class="string">&quot;strike&quot;</span>].groupby([<span class="string">&#x27;home&#x27;</span>])[<span class="string">&#x27;calledRight&#x27;</span>].value_counts(normalize = <span class="literal">True</span>)*<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<pre><code>True     52.941176
False    47.058824
Name: calledRight, dtype: float64


home  calledRight
away  True           53.703704
      False          46.296296
home  True           52.083333
      False          47.916667
Name: calledRight, dtype: float64
</code></pre>
<p>Interestingly of all <code>strike</code> calls in this game, only 52.9% of the calls were called correctly. In other words, 47.1% of all strike calls should have been called <code>ball</code>.</p>
<p>On the bright side, the proportion of correctly called strikes to incorrectly called strikes are almost the same at the home&#x2F;away level. So the umpire was not biased againt the away team.</p>
<p>Visual inspection shows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fig = px.scatter(df_634642[df_634642.call == <span class="string">&quot;strike&quot;</span>], x=<span class="string">&quot;x&quot;</span>, y=<span class="string">&quot;z&quot;</span>, color=<span class="string">&quot;calledRight&quot;</span>, facet_col=<span class="string">&quot;home&quot;</span>,</span><br><span class="line">          labels=&#123;<span class="string">&quot;call&quot;</span>: <span class="string">&quot;Call&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x2&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fig.update_traces(marker=<span class="built_in">dict</span>(size=<span class="number">12</span>,</span><br><span class="line">                              line=<span class="built_in">dict</span>(width=<span class="number">2</span>,</span><br><span class="line">                                        color=<span class="string">&#x27;DarkSlateGrey&#x27;</span>)),</span><br><span class="line">                  selector=<span class="built_in">dict</span>(mode=<span class="string">&#x27;markers&#x27;</span>))</span><br><span class="line"></span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://michaelhur.github.io/images/20210611/3.png"></p>
<ul>
<li><p>Looking at the home team pitcher’s strike zone, we see only 3 strike calls that are labelled “incorrectly called” that lie in the strike zone. This is due to the process of fixing the strike zone for all batters. </p>
</li>
<li><p>For the home pitchers, most of the incorrectly called strikes are placed on the bottom right corner of the plot. On the other hand, for the away pitchers, it were mostly <code>wide pitches</code> that were called strike incorrectly.</p>
</li>
</ul>
<p>Now look at all the <code>ball</code> calls.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df_634642[df_634642.call == <span class="string">&quot;ball&quot;</span>][<span class="string">&#x27;calledRight&#x27;</span>].value_counts(normalize = <span class="literal">True</span>)*<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(df_634642[df_634642.call == <span class="string">&quot;ball&quot;</span>].groupby([<span class="string">&#x27;home&#x27;</span>])[<span class="string">&#x27;calledRight&#x27;</span>].value_counts(normalize = <span class="literal">True</span>)*<span class="number">100</span>)</span><br></pre></td></tr></table></figure>

<pre><code>True     97.744361
False     2.255639
Name: calledRight, dtype: float64


home  calledRight
away  True           98.717949
      False           1.282051
home  True           96.363636
      False           3.636364
Name: calledRight, dtype: float64
</code></pre>
<p>Umpires are doing better job on this side of the call. 97% of all <code>balls</code> are called correctly. My guess is that umpires are more conservative on calling <code>balls</code> than <code>strikes</code>.</p>
<p>Enough with the opening game of the season, let’s get back in the game. Follow the same process for all of Ryu’s game.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pd_index = [<span class="string">&quot;atbat&quot;</span>, <span class="string">&quot;pitchCount&quot;</span>, <span class="string">&quot;inning&quot;</span>, <span class="string">&quot;home&quot;</span>, <span class="string">&quot;pitcher&quot;</span>, <span class="string">&quot;pitcherId&quot;</span>, <span class="string">&quot;pitchHand&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;batter&quot;</span>, <span class="string">&quot;batterId&quot;</span>, <span class="string">&quot;batSide&quot;</span>, <span class="string">&quot;sz_top&quot;</span>, <span class="string">&quot;sz_bottom&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;call&quot;</span>, <span class="string">&quot;actual&quot;</span>]</span><br><span class="line"></span><br><span class="line">ryu_df = pd.DataFrame(index = pd_index).T</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> gamePk <span class="keyword">in</span> tqdm(gamePks):</span><br><span class="line">    <span class="comment">#print(gamePk)</span></span><br><span class="line">    df_new = to_df(get_pitchfx(gamePk))</span><br><span class="line">    ryu_df = pd.concat([ryu_df,df_new])</span><br><span class="line"></span><br><span class="line">ryu_df = ryu_df[ryu_df.pitcherId == <span class="number">547943</span>]</span><br><span class="line">ryu_df = ryu_df.reset_index(drop = <span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<pre><code>100%|██████████| 66/66 [01:14&lt;00:00,  1.13s/it]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fig = px.scatter(ryu_df, x=<span class="string">&quot;x&quot;</span>, y=<span class="string">&quot;z&quot;</span>, color=<span class="string">&quot;call&quot;</span>)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">fig.update_traces(marker=<span class="built_in">dict</span>(size=<span class="number">12</span>,</span><br><span class="line">                              line=<span class="built_in">dict</span>(width=<span class="number">2</span>,</span><br><span class="line">                                        color=<span class="string">&#x27;DarkSlateGrey&#x27;</span>)),</span><br><span class="line">                  selector=<span class="built_in">dict</span>(mode=<span class="string">&#x27;markers&#x27;</span>))</span><br><span class="line"></span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>


<p><img src="https://michaelhur.github.io/images/20210611/4.png"></p>
<p>Looking at only the <code>strike</code> calls:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fig = px.scatter(ryu_df[ryu_df[<span class="string">&#x27;call&#x27;</span>] == <span class="string">&#x27;strike&#x27;</span>], x=<span class="string">&quot;x&quot;</span>, y=<span class="string">&quot;z&quot;</span>)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line">fig.update_traces(marker=<span class="built_in">dict</span>(size=<span class="number">12</span>,</span><br><span class="line">                              line=<span class="built_in">dict</span>(width=<span class="number">2</span>,</span><br><span class="line">                                        color=<span class="string">&#x27;DarkSlateGrey&#x27;</span>)),</span><br><span class="line">                  selector=<span class="built_in">dict</span>(mode=<span class="string">&#x27;markers&#x27;</span>))</span><br><span class="line"></span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://michaelhur.github.io/images/20210611/5.png"></p>
<p>Visual inspection implies that Ryu’s strike zone is wider to both sides. However, when we also look at all the <code>ball</code> calls, we see:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fig = px.scatter(ryu_df, x=<span class="string">&quot;x&quot;</span>, y=<span class="string">&quot;z&quot;</span>, color=<span class="string">&quot;calledRight&quot;</span>, facet_col=<span class="string">&quot;call&quot;</span>,</span><br><span class="line">          labels=&#123;<span class="string">&quot;calledRight&quot;</span>: <span class="string">&quot;called Right&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fig.add_shape(<span class="built_in">type</span>=<span class="string">&quot;rect&quot;</span>,</span><br><span class="line">    xref = <span class="string">&quot;x2&quot;</span>, yref = <span class="string">&quot;y&quot;</span>,</span><br><span class="line">    x0 = -<span class="number">0.71</span>, y0 = <span class="number">1.5</span>,</span><br><span class="line">    x1 = <span class="number">0.71</span>, y1 = <span class="number">3.5</span>,</span><br><span class="line">    line=<span class="built_in">dict</span>(</span><br><span class="line">        color=<span class="string">&quot;RoyalBlue&quot;</span>,</span><br><span class="line">        width=<span class="number">3</span>,</span><br><span class="line">    )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">fig.update_traces(marker=<span class="built_in">dict</span>(size=<span class="number">12</span>,</span><br><span class="line">                              line=<span class="built_in">dict</span>(width=<span class="number">2</span>,</span><br><span class="line">                                        color=<span class="string">&#x27;DarkSlateGrey&#x27;</span>)),</span><br><span class="line">                  selector=<span class="built_in">dict</span>(mode=<span class="string">&#x27;markers&#x27;</span>))</span><br><span class="line"></span><br><span class="line">fig.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://michaelhur.github.io/images/20210611/6.png"></p>
<p>Almost all <code>ball</code> calls are called correctly, and there are so many <code>ball</code> calls landed at the same region as those <code>strike</code> calls to the sides of the strike zone. This implies that he has pitches they moves horizontally, leading to <code>swinging strikes</code>.</p>
<p>These are some of the very few insights one can derive from the visualization of pitch fx data. One can inspect this at the umpire level and see how they perform.</p>
<h4 id="Try-it-yourself"><a href="#Try-it-yourself" class="headerlink" title="Try it yourself!"></a>Try it yourself!</h4><p>Using the following code, you can try plotting them yourself.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PyMLB <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_df</span>(<span class="params">pitchfx</span>):</span><br><span class="line">    </span><br><span class="line">    pitches = &#123;k:v <span class="keyword">for</span> k, v <span class="keyword">in</span> pitchfx.items() <span class="keyword">if</span> k != <span class="string">&quot;home_umpire&quot;</span>&#125;    </span><br><span class="line"></span><br><span class="line">    pd_index = [<span class="string">&quot;atbat&quot;</span>, <span class="string">&quot;pitchCount&quot;</span>, <span class="string">&quot;inning&quot;</span>, <span class="string">&quot;home&quot;</span>, <span class="string">&quot;pitcher&quot;</span>, <span class="string">&quot;pitcherId&quot;</span>, <span class="string">&quot;pitchHand&quot;</span>,</span><br><span class="line">                 <span class="string">&quot;batter&quot;</span>, <span class="string">&quot;batterId&quot;</span>, <span class="string">&quot;batSide&quot;</span>, <span class="string">&quot;sz_top&quot;</span>, <span class="string">&quot;sz_bottom&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;z&quot;</span>, <span class="string">&quot;call&quot;</span>, <span class="string">&quot;actual&quot;</span>]</span><br><span class="line"></span><br><span class="line">    new_df = pd.DataFrame(index = pd_index).T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> pitches.items():</span><br><span class="line">        atbat = k</span><br><span class="line">        inning = v[<span class="string">&#x27;inning&#x27;</span>]</span><br><span class="line">        home = v[<span class="string">&#x27;home&#x27;</span>]</span><br><span class="line">        pitcher = v[<span class="string">&#x27;pitcher&#x27;</span>][<span class="string">&#x27;fullName&#x27;</span>]</span><br><span class="line">        pitcherId = v[<span class="string">&#x27;pitcher&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        pitchHand = v[<span class="string">&#x27;pitchHand&#x27;</span>]</span><br><span class="line">        batter = v[<span class="string">&#x27;batter&#x27;</span>][<span class="string">&#x27;fullName&#x27;</span>]</span><br><span class="line">        batterId = v[<span class="string">&#x27;batter&#x27;</span>][<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line">        batSide = v[<span class="string">&#x27;batSide&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pitchCount = <span class="number">0</span>   </span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> v[<span class="string">&#x27;pitchData&#x27;</span>]:</span><br><span class="line">            pitchCount += <span class="number">1</span></span><br><span class="line">            sz_top = p[<span class="string">&#x27;sz_top&#x27;</span>]</span><br><span class="line">            sz_bottom = p[<span class="string">&#x27;sz_bottom&#x27;</span>]</span><br><span class="line">            x = p[<span class="string">&#x27;x&#x27;</span>]</span><br><span class="line">            z = p[<span class="string">&#x27;z&#x27;</span>]</span><br><span class="line">            call = p[<span class="string">&#x27;call&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            actual = <span class="string">&quot;strike&quot;</span> <span class="keyword">if</span> (sz_bottom &lt;= z &lt;= sz_top) <span class="keyword">and</span> (-<span class="number">0.71</span> &lt; x &lt; <span class="number">0.71</span>) <span class="keyword">else</span> <span class="string">&quot;ball&quot;</span></span><br><span class="line"></span><br><span class="line">            new_row = [atbat, pitchCount, inning, home, pitcher, pitcherId, pitchHand,</span><br><span class="line">                       batter, batterId, batSide, sz_top, sz_bottom, x, z, call, actual]</span><br><span class="line"></span><br><span class="line">            new_df1 = pd.DataFrame(new_row, index = pd_index).T</span><br><span class="line">            new_df = pd.concat([new_df,new_df1])</span><br><span class="line"></span><br><span class="line">    new_df[<span class="string">&#x27;calledRight&#x27;</span>] = (new_df[<span class="string">&#x27;call&#x27;</span>] == new_df[<span class="string">&#x27;actual&#x27;</span>])</span><br><span class="line">    new_df[<span class="string">&#x27;umpire&#x27;</span>] = pitchfx[<span class="string">&#x27;home_umpire&#x27;</span>]</span><br><span class="line">    new_df.reset_index(drop = <span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span>(new_df)</span><br></pre></td></tr></table></figure>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/09/2021-06-11-Strike%20Zone/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 Michael Hur. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">Michael Hur</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-zoi9cv3fxbuk68sxg0xkjhah3klemljfujipeswdtomoblnegzlm06beywp6.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
